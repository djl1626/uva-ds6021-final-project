---
title: "Projectwork1"
author: "Zach Stautzenbach"
date: "2024-07-25"
output: html_document
---

```{r}
library(tidyverse)
```

```{r}
stars <- read.csv("C:\\Users\\saint\\Downloads\\Stars_clean_r.csv")
```

```{r}
head(stars)
```

Variables:
L: luminosity
R: radius
A_M: absolute magnitude
```{r}
#temperature as response
stars2 <- gather(stars, key="predictor", value="value",
                 L, R, A_M)
ggplot(stars2, aes(x=value, y=Temperature,color=predictor))+geom_point()+
  facet_wrap(~predictor,scales = "free_x")
```
Multiple regression:
- have one on all numerical variables
- have another one for adding color as a predictor

```{r}
#luminosity as response
stars3 <- gather(stars, key="predictor", value="value",
                 Temperature, R, A_M)
ggplot(stars3, aes(x=value, y=L,color=predictor))+geom_point()+
  facet_wrap(~predictor,scales = "free_x")
```



# Model for luminosity as response

```{r}
#Removing index
stars2 = stars[,-1]
```


```{r}
#changing column names
names(stars2) <- c("Temperature","Luminosity", "Radius", "Abs_Magnitude","Color",
                   "Spectral_Class","Type")
```


```{r}
#Building model
model1 <- lm(Luminosity~Temperature+Radius+Abs_Magnitude, data = stars2)
summary(model1)
```
# Checking assumptions:
1. Residual plot
```{r}
stars_predict <- mutate(stars2, predictions=fitted(model1),
                        resid=residuals(model1))
```

```{r}
ggplot(stars_predict, aes(x=predictions, y=resid))+geom_point()+geom_hline(yintercept=0, color = "red")
```
2. QQplot (4th assumption)
```{r}
ggplot(stars_predict, aes(sample=resid))+stat_qq()+stat_qq_line(color="red")
```

# Doing transformations:

 1/3 of m: sign(Abs_Magnitude)*(abs(Abs_Magnitude)^(1/3)))
```{r}
#Log Transformations (except magnitude due to negatives)
stars_t <- mutate(stars2, l3 = log(Luminosity), t3 = log(Temperature), r3 = log(Radius), m3 = Abs_Magnitude)
```


```{r}
stars_t2 <- gather(stars_t, key="predictor", value="value",
                  t3,r3, m3)
```


```{r}
ggplot(stars_t2, aes(x=value, y=l3,color=predictor))+geom_point()+
  facet_wrap(~predictor,scales = "free_x")
```


```{r}
model_t <- lm(l3~t3+r3+m3, data = stars_t)
summary(model_t)
```
Assumptions for cube root transformation model:
```{r}
predict_t <- mutate(stars_t, predictions = fitted(model_t), resid=residuals(model_t))
```


```{r}
#Residual plot
ggplot(predict_t, aes(x=predictions, y=resid))+geom_point()+geom_hline(yintercept=0, color = "red")
```

```{r}
#qqplot
ggplot(predict_t, aes(sample=resid))+stat_qq()+stat_qq_line(color="red")
```

# checking for MC:
```{r}
stars_mc <- subset(stars_t, select = -c(Temperature, Luminosity, Radius, Abs_Magnitude, Color,
                                         Spectral_Class,Type))
```

```{r}
cor_mat <- round(cor(stars_mc),2)
```

```{r}
library(ggcorrplot)
```

```{r}
ggcorrplot(cor_mat, lab=TRUE, type="lower", method="circle")
```

```{r}
#calcing VIFs
library(car)
vif(model_t)
```


#Trying ridge

```{r}
library(glmnet)
```


```{r}
x <- model.matrix(l3~0+., data = stars_mc)
y <- stars_mc$l3
```

```{r}
rmodel <- glmnet(x=x, y=y, alpha = 0)
```

```{r}
kcvglmnet <- cv.glmnet(x=x, y=y, alpha = 0, nfolds = 10)
kcvglmnet$lambda.1se
```

```{r}
predict(rmodel, type = "coefficient", s = kcvglmnet$lambda.1se, newx = x[1:2,])
```

```{r}
#Plot of coefficients with lambda 1 standard deviation away from minimum
plot(rmodel, label = T, xvar="lambda")+abline(v=log(kcvglmnet$lambda.1se))
```

# Taking out magnitude

```{r}
stars_nom <- mutate(stars2, l3 = log(Luminosity), t3 = log(Temperature), r3 = log(Radius))
```


```{r}
stars_tn <- gather(stars_nom, key="predictor", value="value",
                  t3,r3)
```

```{r}
#Graphing predictors with response
ggplot(stars_tn, aes(x=value, y=l3,color=predictor))+geom_point()+
  facet_wrap(~predictor,scales = "free_x")
```


```{r}
#New model wiith radius and temperature predicting luminosity
model_n <- lm(l3~r3+t3, data = stars_nom)
summary(model_n)
```
```{r}
predict_nm <- mutate(stars_nom, predictions = fitted(model_n),
                     resid=residuals(model_n))
```

```{r}
#Residual plot of new model
ggplot(predict_nm, aes(x=predictions, y = resid))+geom_point()+geom_hline(yintercept=0,color="red")
```

```{r}
#qqplot of new model
ggplot(predict_nm, aes(sample=resid))+stat_qq()+stat_qq_line(color="red")
```




```{r}
stars_mc2 <- subset(stars_t, select = -c(Temperature, Luminosity, Radius, Abs_Magnitude, Color,
                                         Spectral_Class,Type, m3))
```

```{r}
#creating correlation matrix
cor_mat2 <- round(cor(stars_mc2),2)
```

```{r}
#plot of correlation matrix
ggcorrplot(cor_mat2, lab = TRUE, type = "lower")
```

```{r}
#VIF of new model
vif(model_n)
```



